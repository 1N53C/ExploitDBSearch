import yaml
import os
import smtplib
import ssl


# Load SMTP credentials from config
def load_config():
    with open(os.path.join(os.path.dirname(__file__), '../config/smtp_config.yaml'), 'r') as smtp_config:
        config = yaml.load(smtp_config, Loader=yaml.FullLoader)
        return config


# Send mail
def send_mail(message):
    config = load_config()
    context = ssl.create_default_context()

    try:
        server = smtplib.SMTP(config['smtp_config']['smtp_server'], config.['smtp_config']['port'])
        server.ehlo()
        server.starttls(context=context)
        server.ehlo()
        server.login(config['smtp_config']['sender_email'], config['smtp_config']['password'])

        server.sendmail(
            config['smtp_config']['sender_email'],
            config['smtp_config']['receiver_email'],
            message
        )
        server.quit()
    except Exception as e:
        print("[!] Email Delivery failed!")
    finally:
        exit()
