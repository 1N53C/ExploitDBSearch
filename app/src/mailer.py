import yaml
import os
import smtplib
import ssl


def load_config():
    with open(os.path.join(os.path.dirname(__file__), '../config/smtp_config.yaml'), 'r') as smtp_config:
        config = yaml.load(smtp_config, Loader=yaml.FullLoader)
        # print (config['smtp_config']['port'])
        return config


def send_mail(message):
    smtp_config = load_config()
    context = ssl.create_default_context()

    try:
        server = smtplib.SMTP(smtp_config['smtp_server'], smtp_config['port'])
        server.ehlo()
        server.starttls(context=context)
        server.ehlo()
        server.login(smtp_config['sender_email'], smtp_config['password'])

        server.sendmail(
            smtp_config['sender_email'],
            smtp_config['receiver_email'],
            message
        )
    except Exception as e:
        print("[!] Email Delivery failed!")
    finally:
        server.quit()