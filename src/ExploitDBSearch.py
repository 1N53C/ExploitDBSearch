#!/usr/bin/python3

import os
import time
import subprocess

searches = ['jira', 'confluence', 'gitlab']


def create_timestamp():
    return str(time.time()).split('.')[0]

def get_last_files():
    for s in searches:
        cwd = os.getcwd()
        files = [os.path.join(cwd + '/output/', x) for x in os.listdir(cwd + '/output') if x.endswith('_' + s +'.txt')]
        newest = max(files, key=os.path.getctime)
        print("Recently modified Docs", newest)


def search():
    timestamp = create_timestamp()
    for s in searches:
        cmd = 'searchsploit ' + s
        output = subprocess.check_output(cmd, shell=True, text=True)
        out_file = open('output/' + timestamp + '_' + s + '.txt', "a")
        out_file.write(output)
        out_file.close()


search()
get_last_files()
